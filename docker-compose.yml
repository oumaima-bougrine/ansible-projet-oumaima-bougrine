networks:
  ansible-net:   # <-- Déclarer le réseau ici
    driver: bridge

services:
  web1:
    build:
      context: .
      dockerfile: Dockerfile   # Dockerfile fourni par le prof
    container_name: ansible-web1
    hostname: web1
    command: /usr/sbin/sshd -D -e
    ports:
      - "2221:22"
      - "8081:80"
    networks:
      - ansible-net
    tty: true
    stdin_open: true

  web2:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ansible-web2
    hostname: web2
    command: /usr/sbin/sshd -D -e
    ports:
      - "2222:22"
      - "8082:80"
    networks:
      - ansible-net
    tty: true
    stdin_open: true

  db1:
    build:
      context: .
      dockerfile: Dockerfile-db   # Dockerfile avec PostgreSQL + SSH
    container_name: ansible-db1
    hostname: db1
    environment:
      POSTGRES_DB: appdb
      POSTGRES_USER: appuser
      POSTGRES_PASSWORD: apppass123
    ports:
      - "2223:22"      # SSH
      - "5432:5432"    # PostgreSQL
      - "3000:3000"    # Node.js API
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    networks:
      - ansible-net
    # Entrypoint dans l'image : attend /opt/app puis lance Node (persistant)
